<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Miru Settings</title>
  <link rel="stylesheet" href="settings.css">
</head>
<body>
  <div class="container">
    <header>
      <button class="btn-back" id="btnBack">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M19 12H5M12 19l-7-7 7-7"/>
        </svg>
        Back
      </button>
      <h1>Settings</h1>
    </header>

    <main>
      <!-- Built-in Sites Section -->
      <section class="section">
        <h2>Built-in Sites</h2>
        <div class="site-list">
          <div class="site-card readonly">
            <div class="site-header">
              <span class="site-name">Crunchyroll</span>
              <span class="badge badge-success">Active</span>
            </div>
            <div class="site-details">
              <span class="domain">*.crunchyroll.com</span>
            </div>
          </div>

          <div class="site-card readonly">
            <div class="site-header">
              <span class="site-name">AniWatch / Zoro</span>
              <span class="badge badge-success">Active</span>
            </div>
            <div class="site-details">
              <span class="domain">*.aniwatch.to, *.zoro.to</span>
            </div>
          </div>

          <div class="site-card readonly">
            <div class="site-header">
              <span class="site-name">AniWorld</span>
              <span class="badge badge-success">Active</span>
            </div>
            <div class="site-details">
              <span class="domain">*.aniworld.to</span>
            </div>
          </div>
        </div>
      </section>

      <!-- Custom Sites Section -->
      <section class="section">
        <div class="section-header">
          <h2>Custom Sites</h2>
          <button class="btn btn-primary" id="btnAddSite">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="12" y1="5" x2="12" y2="19"/>
              <line x1="5" y1="12" x2="19" y2="12"/>
            </svg>
            Add Site
          </button>
        </div>

        <div id="customSitesList" class="site-list">
          <div class="empty-state" id="emptyState">
            <p>No custom sites configured.</p>
            <p class="hint">Add a streaming site to track your anime watching.</p>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- Add/Edit Site Modal -->
  <div class="modal" id="siteModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="modalTitle">Add Custom Site</h2>
        <button class="btn-close" id="btnCloseModal">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
      </div>

      <div class="modal-body">
        <div class="tabs">
          <button class="tab active" data-tab="basic">Basic</button>
          <button class="tab" data-tab="title">Title</button>
          <button class="tab" data-tab="episode">Episode</button>
          <button class="tab" data-tab="advanced">Advanced</button>
          <button class="tab" data-tab="test">Test</button>
        </div>

        <form id="siteForm">
          <!-- Basic Tab -->
          <div class="tab-content active" data-tab="basic">
            <div class="form-group">
              <label for="siteName">Site Name</label>
              <input type="text" id="siteName" class="form-control" placeholder="e.g., MyAnimeStream" required>
              <small>Display name for this site</small>
            </div>

            <div class="form-group">
              <label for="siteDomain">Domain Pattern</label>
              <input type="text" id="siteDomain" class="form-control" placeholder="e.g., *.example.com" required>
              <small>Use * as wildcard. Example: *.mysite.com</small>
            </div>

            <div class="form-group">
              <label for="videoSelector">Video Selector</label>
              <input type="text" id="videoSelector" class="form-control" placeholder="e.g., video" value="video">
              <small>CSS selector for video element</small>
            </div>

            <div class="form-group">
              <label for="videoIframe">Video Iframe Selector</label>
              <input type="text" id="videoIframe" class="form-control" placeholder="e.g., iframe[src*='player']">
              <small>Optional: For sites using iframe players</small>
            </div>
          </div>

          <!-- Title Extraction Tab -->
          <div class="tab-content" data-tab="title">
            <div class="form-group">
              <label for="titleMethod">Extraction Method</label>
              <select id="titleMethod" class="form-control">
                <option value="regex">Page Title (Regex)</option>
                <option value="selector">DOM Selector</option>
                <option value="meta">Meta Tag</option>
                <option value="jsonld">JSON-LD</option>
              </select>
            </div>

            <div class="method-config" data-method="regex">
              <div class="form-group">
                <label for="titleRegex">Title Regex Pattern</label>
                <input type="text" id="titleRegex" class="form-control" placeholder="e.g., ^Watch\\s+(.+?)\\s+Episode">
                <small>Regex to extract title from page title</small>
              </div>
              <div class="form-group">
                <label for="titleRegexGroup">Capture Group</label>
                <input type="number" id="titleRegexGroup" class="form-control" value="1" min="1">
              </div>
            </div>

            <div class="method-config hidden" data-method="selector">
              <div class="form-group">
                <label for="titleSelector">Title Selector</label>
                <input type="text" id="titleSelector" class="form-control" placeholder="e.g., h1.anime-title">
              </div>
            </div>

            <div class="method-config hidden" data-method="meta">
              <div class="form-group">
                <label for="titleMetaProperty">Meta Property</label>
                <input type="text" id="titleMetaProperty" class="form-control" placeholder="e.g., og:title">
              </div>
            </div>

            <div class="method-config hidden" data-method="jsonld">
              <div class="form-group">
                <label for="titleJsonPath">JSON Path</label>
                <input type="text" id="titleJsonPath" class="form-control" placeholder="e.g., partOfSeries.name">
              </div>
            </div>
          </div>

          <!-- Episode Extraction Tab -->
          <div class="tab-content" data-tab="episode">
            <div class="form-group">
              <label for="episodeMethod">Extraction Method</label>
              <select id="episodeMethod" class="form-control">
                <option value="regex">Page Title (Regex)</option>
                <option value="selector">DOM Selector</option>
                <option value="url">URL Pattern</option>
              </select>
            </div>

            <div class="episode-method-config" data-method="regex">
              <div class="form-group">
                <label for="episodeRegex">Episode Regex Pattern</label>
                <input type="text" id="episodeRegex" class="form-control" placeholder="e.g., Episode\\s+(\\d+)">
              </div>
              <div class="form-group">
                <label for="episodeRegexGroup">Capture Group</label>
                <input type="number" id="episodeRegexGroup" class="form-control" value="1" min="1">
              </div>
            </div>

            <div class="episode-method-config hidden" data-method="selector">
              <div class="form-group">
                <label for="episodeSelector">Episode Selector</label>
                <input type="text" id="episodeSelector" class="form-control" placeholder="e.g., .episode-number">
              </div>
            </div>

            <div class="episode-method-config hidden" data-method="url">
              <div class="form-group">
                <label for="episodeUrlPattern">URL Pattern</label>
                <input type="text" id="episodeUrlPattern" class="form-control" placeholder="e.g., episode-(\\d+)">
              </div>
            </div>
          </div>

          <!-- Advanced Tab -->
          <div class="tab-content" data-tab="advanced">
            <div class="form-group">
              <label for="seasonMethod">Season Extraction</label>
              <select id="seasonMethod" class="form-control">
                <option value="none">None</option>
                <option value="url">URL Pattern</option>
                <option value="regex">Page Title (Regex)</option>
              </select>
            </div>

            <div class="form-group" id="seasonPatternGroup" style="display: none;">
              <label for="seasonPattern">Season Pattern</label>
              <input type="text" id="seasonPattern" class="form-control" placeholder="e.g., season-(\\d+)">
            </div>

            <div class="form-group">
              <label for="retryAttempts">Retry Attempts</label>
              <input type="number" id="retryAttempts" class="form-control" value="5" min="0" max="20">
              <small>For SPA sites with delayed content</small>
            </div>

            <div class="form-group">
              <label for="waitSelectors">Wait for Selectors</label>
              <input type="text" id="waitSelectors" class="form-control" placeholder="e.g., h1.title, .video-player">
              <small>Comma-separated selectors to wait for</small>
            </div>
          </div>

          <!-- Test Tab -->
          <div class="tab-content" data-tab="test">
            <div class="test-info">
              <p>Open a page on your custom site and test if extraction works.</p>
              <button type="button" class="btn btn-secondary" id="btnTestExtraction">Test on Current Tab</button>
            </div>

            <div id="testResults" class="test-results hidden">
              <h3>Extraction Results</h3>
              <div class="result-item">
                <label>Title:</label>
                <span id="testTitle" class="result-value">-</span>
              </div>
              <div class="result-item">
                <label>Episode:</label>
                <span id="testEpisode" class="result-value">-</span>
              </div>
              <div class="result-item">
                <label>Season:</label>
                <span id="testSeason" class="result-value">-</span>
              </div>
              <div class="result-item">
                <label>Status:</label>
                <span id="testStatus" class="result-value">-</span>
              </div>
            </div>
          </div>
        </form>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" id="btnCancelModal">Cancel</button>
        <button type="button" class="btn btn-primary" id="btnSaveSite">Save Site</button>
      </div>
    </div>
  </div>

  <script src="settings.js"></script>
</body>
</html>
